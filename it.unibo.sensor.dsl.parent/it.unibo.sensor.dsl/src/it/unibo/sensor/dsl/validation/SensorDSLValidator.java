/*
 * generated by Xtext 2.37.0
 */
package it.unibo.sensor.dsl.validation;


import it.unibo.sensor.dsl.sensorDSL.*;
import org.checkerframework.checker.nullness.qual.NonNull;
import org.eclipse.xtext.validation.Check;
import org.eclipse.xtext.validation.CheckType;

/**
 * This class contains custom validation rules. 
 *
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
public class SensorDSLValidator extends AbstractSensorDSLValidator {

    @Check(CheckType.FAST)
    public void ensureNameNotEmpty(@NonNull Sensor info) {
        final String name = info.getName();
        if (name.isEmpty()) {
            error("The sensor's name must not be empty.", info, SensorDSLPackage.Literals.SENSOR__NAME);
        }
    }

    @Check(CheckType.FAST)
    public void ensureDescriptionNotEmpty(@NonNull GeneralSensorInfo info) {
        final String description= info.getDescription();
        if (description.isEmpty()) {
            error("The sensor's info description must not be empty.", info, SensorDSLPackage.Literals.GENERAL_SENSOR_INFO__DESCRIPTION);
        }
    }

    @Check(CheckType.FAST)
    public void ensureThresholdValueIsValid(@NonNull Query query) {
        final String value = query.getValue();
        try {
            final double doubleValue = Double.parseDouble(value);
            final int limit = 10_000;
            if (limit < doubleValue || doubleValue < -limit) {
                error("The value must valid and must be in the interval [%s, %s].".formatted(-limit, limit), query, SensorDSLPackage.Literals.QUERY__VALUE, 0);
            }
        } catch (Exception e) {
            error("The value must be a valid double.", query, SensorDSLPackage.Literals.QUERY__VALUE, 0);
        }
    }

    @Check(CheckType.FAST)
    public void ensureNetworkIsValid(@NonNull GeneralNetworkInfo info) {
        final String ip = info.getIp();
        final int port = info.getPort();
        if (port >= 0 && port <= 1023) {
            warning("You should use a non registered port.", info, SensorDSLPackage.Literals.GENERAL_NETWORK_INFO__IP);
        }
        else if (port < 0 || port > 65_535) {
            error("The port is not valid, it must be in the interval [0, 65_535].", info, SensorDSLPackage.Literals.GENERAL_NETWORK_INFO__PORT);
        }
        if (!NetworkUtils.isValid(ip)){
            error("The input ip must be a valid Ipv4 or Ipv6", info, SensorDSLPackage.Literals.GENERAL_NETWORK_INFO__IP);
        }
    }
}
